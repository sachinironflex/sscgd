<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSC GD QUIZ APP тАФ All Chapters</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <!-- Firebase compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-database-compat.js"></script>

    <style>
        :root{
            --bg:#0f1724; --card:#0b1220; --accent:#00bfff;
        }
        body{font-family:'Poppins',sans-serif;background:var(--bg);color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;padding:20px}
        .wrap{width:100%;max-width:900px;background:rgba(15,23,36,.95);border-radius:12px;padding:20px;border:2px solid rgba(0,191,255,.08)}
        h1{margin:0 0 12px;font-size:26px;color:#ff6b6b}
        .btn{background:var(--accent);color:#001;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600; font-size: 14px;}
        .btn.ghost{background:#1f2937;color:#fff}
        .btn.warn{background:#ff6b6b;color:#fff}
        .flex{display:flex;gap:8px;flex-wrap:wrap; align-items: center;}
        .hidden{display:none!important}
        select,input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#071026;color:#fff}
        .col{display:flex;flex-direction:column;gap:10px}
        .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid #1f2937}
        .message{padding:10px;border-radius:8px;margin-top:8px}
        .success{background:#065f46;color:#fff}
        .error{background:#7f1d1d;color:#fff}

        /* chapters list scroll */
        .chapter-list{display:flex;flex-direction:column;gap:8px;margin-top:12px;max-height:52vh;overflow:auto;padding-right:6px}
        .chapter-list .btn{width:100%;text-align:left;padding:10px;border-radius:8px}
        .question-box{background:#071026;padding:12px;border-radius:8px;margin-top:10px}
        .question-list-item{display:flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #334155;}
        .question-list-item .btn {padding: 6px 10px;}
    </style>
</head>
<body>
  <div class="wrap">
    <h1 id="main-title">SSC GD QUIZ APP</h1>

    <!-- MAIN SCREEN -->
    <div id="main-screen" class="col">
      <div class="flex" style="margin-bottom:12px">
        <button id="ssc-gd-btn" class="btn">ЁЯУЪ SSC GD</button>
        <button id="admin-login-btn" class="btn warn">тЪЩя╕П Admin Login</button>
      </div>
    </div>

    <!-- SUBJECT SCREEN -->
    <div id="subject-screen" class="col hidden">
      <div class="flex">
        <button id="hindi-btn" class="btn ghost">ЁЯЗоЁЯЗ│ рд╣рд┐рдВрджреА</button>
        <button id="math-btn" class="btn ghost">тЮХ рдЧрдгрд┐рдд</button>
        <button id="reasoning-btn" class="btn ghost">ЁЯза рд░реАрдЬрд╝рдирд┐рдВрдЧ</button>
        <button id="gk-gs-btn" class="btn ghost">ЁЯМН GK/GS</button>
      </div>
    </div>

    <!-- CHAPTERS SCREEN -->
    <div id="chapters-screen" class="col hidden"></div>

    <!-- QUESTIONS SCREEN -->
    <div id="questions-screen" class="col hidden"></div>

    <!-- ADMIN LOGIN SCREEN -->
    <div id="admin-login-screen" class="col hidden">
      <div class="card" style="max-width:480px">
        <label>рдИрдореЗрд▓</label>
        <input id="admin-email" type="email" placeholder="рдИрдореЗрд▓ рджрд░реНрдЬ рдХрд░реЗрдВ" />
        <label>рдкрд╛рд╕рд╡рд░реНрдб</label>
        <input id="admin-password" type="password" placeholder="рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░реЗрдВ" />
        <div class="flex" style="margin-top:8px">
          <button id="login-btn" class="btn">рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ</button>
          <button id="back-to-main-from-login" class="btn ghost">тЖР рд╡рд╛рдкрд╕</button>
        </div>
        <div id="login-message" class="message hidden"></div>
      </div>
    </div>

    <!-- ADMIN PANEL SCREEN -->
    <div id="admin-panel-screen" class="col hidden">
      <div class="card" style="max-width:860px">
        <h3>рдкреНрд░рд╢реНрди рдЕрдкрд▓реЛрдб / рдореИрдиреЗрдЬ рдХрд░реЗрдВ</h3>
        <div class="col" style="margin-top:8px">
          <label>рд╕рдмреНрдЬреЗрдХреНрдЯ рдЪреБрдиреЗрдВ</label>
          <select id="subject-select"></select>

          <label>рдЪреИрдкреНрдЯрд░ рдЪреБрдиреЗрдВ</label>
          <select id="chapter-select"></select>

          <label>рдкреНрд░рд╢реНрди</label>
          <textarea id="question-text" rows="3" placeholder="рдкреНрд░рд╢реНрди рдпрд╣рд╛рдБ рд▓рд┐рдЦреЗрдВ"></textarea>

          <label>рд╕рд╣реА рдЙрддреНрддрд░</label>
          <input id="answer-text" type="text" placeholder="рд╕рд╣реА рдЙрддреНрддрд░" />

          <label>рд╡рд┐рд╡рд░рдг (рд╡реИрдХрд▓реНрдкрд┐рдХ)</label>
          <textarea id="description-text" rows="2" placeholder="рд╡рд┐рд╡рд░рдг"></textarea>

          <input type="hidden" id="question-key-input" />
          
          <div class="flex">
            <button id="upload-question-btn" class="btn">рдкреНрд░рд╢реНрди рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ</button>
            <button id="update-question-btn" class="btn hidden">рдкреНрд░рд╢реНрди рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ</button>
            <button id="cancel-edit-btn" class="btn ghost hidden">рдХреИрдВрд╕рд┐рд▓</button>
            <button id="back-to-main-from-admin" class="btn ghost">тЖР рд╡рд╛рдкрд╕</button>
          </div>

          <div id="upload-message" class="message hidden"></div>
        </div>

        <div id="questions-list-container" class="col" style="margin-top:20px;">
          <h4>рдореМрдЬреВрджрд╛ рдкреНрд░рд╢реНрди</h4>
          <div id="questions-list">рдХреЛрдИ рдкреНрд░рд╢реНрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред</div>
        </div>
      </div>
    </div>

  </div>

<script>
/* ========== Firebase config ========== */
const firebaseConfig = {
  apiKey: "AIzaSyAYyEHrGV1Ev1FaMO5U3qkHUmdNEHP_IX8",
  authDomain: "sgs-study-hub.firebaseapp.com",
  databaseURL: "https://sgs-study-hub-default-rtdb.firebaseio.com",
  projectId: "sgs-study-hub",
  storageBucket: "sgs-study-hub.firebasestorage.app",
  messagingSenderId: "299932841646",
  appId: "1:299932841646:web:21120e316a9b3134a1df3f"
};
try { firebase.initializeApp(firebaseConfig); console.log('Firebase init OK'); } catch(e){ console.error(e); }
const auth = firebase.auth();
const db = firebase.database();

/* ========== UI refs ========== */
const screens = {
  main: document.getElementById('main-screen'),
  subject: document.getElementById('subject-screen'),
  chapters: document.getElementById('chapters-screen'),
  questions: document.getElementById('questions-screen'),
  adminLogin: document.getElementById('admin-login-screen'),
  adminPanel: document.getElementById('admin-panel-screen')
};
const mainTitle = document.getElementById('main-title');

const sscGDBtn = document.getElementById('ssc-gd-btn');
const adminLoginBtn = document.getElementById('admin-login-btn');

const hindiBtn = document.getElementById('hindi-btn');
const mathBtn = document.getElementById('math-btn');
const reasoningBtn = document.getElementById('reasoning-btn');
const gkGsBtn = document.getElementById('gk-gs-btn');

const subjectSelect = document.getElementById('subject-select');
const chapterSelect = document.getElementById('chapter-select');
const questionText = document.getElementById('question-text');
const answerText = document.getElementById('answer-text');
const descriptionText = document.getElementById('description-text');
const uploadQuestionBtn = document.getElementById('upload-question-btn');
const updateQuestionBtn = document.getElementById('update-question-btn');
const cancelEditBtn = document.getElementById('cancel-edit-btn');
const uploadMessage = document.getElementById('upload-message');
const questionsListContainer = document.getElementById('questions-list-container');
const questionsList = document.getElementById('questions-list');
const questionKeyInput = document.getElementById('question-key-input');

const loginBtn = document.getElementById('login-btn');
const adminEmailInput = document.getElementById('admin-email');
const adminPasswordInput = document.getElementById('admin-password');
const loginMessage = document.getElementById('login-message');
const backToMainFromLogin = document.getElementById('back-to-main-from-login');
const backToMainFromAdmin = document.getElementById('back-to-main-from-admin');

/* ========== Data ========== */
const subjectsData = {
    hindi: { name: 'рд╣рд┐рдВрджреА', emoji: 'ЁЯЗоЁЯЗ│' },
    math: { name: 'рдЧрдгрд┐рдд', emoji: 'тЮХ' },
    reasoning: { name: 'рд░реАрдЬрд╝рдирд┐рдВрдЧ', emoji: 'ЁЯза' },
    gkGs: { name: 'GK/GS', emoji: 'ЁЯМН' }
};
const chaptersData = {
    hindi: {
        'vilom-shabd': 'рд╡рд┐рд▓реЛрдо рд╢рдмреНрдж',
        'vartaniya': 'рд╡рд░реНрддрдиреАрдп',
        'vakyansh': 'рд╡рд╛рдХреНрдпрд╛рдВрд╢',
        'paryavachi': 'рдкрд░реНрдпрд╛рд╡рдЪреА рд╢рдмреНрдж',
        'tatsam-tadbhav': 'рддрддреНрд╕рдо рддрджреНрднрд╡',
        'deshaj-videshaj': 'рджреЗрд╢рдЬ рд╡рд┐рджреЗрд╢рдж рд╢рдмреНрдж',
        'abhyash-prashan': 'рдЕрднрдпрд╛рд╢ рдкреНрд░рд╛рд╢рди рддрддреНрд╕рдо рддрджреНрднрд╡',
        'shabd-yugm': 'рд╢рдмреНрдж рдпреБрдЧреНрдо',
        'anekarthik': 'рдЕрдиреЗрдХрд░рдерд┐рдХ рд╢рдмреНрдж',
        'sangya': 'рд╕рдВрдЬреНрдЮрд╛',
        'sarvanam': 'рд╕рд░реНрд╡рдирд╛рдо',
        'visheshad': 'рд╡рд┐рд╢реЗрд╖рдб',
        'kriya': 'рдХреНрд░рд┐рдпрд╛',
        'kaal': 'рдХрд╛рд▓',
        'link': 'рд▓рд┐рдВрдХ',
        'vachan': 'рд╡рдЪрди',
        'ling-vachan-abhyas': 'рд▓рд┐рдВрдЧ рд╡рдЪрди рдЕрднреНрдпрд╛рд╕',
        'karak': 'рдХрд╛рд░рдХ',
        'avyay': 'рдЕрд╡реНрдпрдп'
    },
    math: {
        'ratio-proporation': 'Ratio & Proporation',
        'lcm-hcf': 'LCM & HCF',
        'time-and-work': 'Time and Work',
        'pipe-tanki': 'Pipe or Tanki',
        'ausat': 'рдФрд╕рдд',
        'pratishat': 'рдкреНрд░рддрд┐рд╢рдд',
        'labh-hani': 'рд▓рд╛рдн рдФрд░ рд╣рд╛рдиреА',
        'batta': 'рдмрдЯреНрдЯрд╛',
        'sadharan-byaj': 'рд╕рд╛рдзрд╛рд░рдг рдмреНрдпрд╛рдЬ',
        'chakravridhhi-byaj': 'рдЪрдХреНрд░рд╡реГрджреНрдзрд┐ рдмреНрдпрд╛рдЬ',
        'samay-chal-duri': 'рд╕рдордп & рдЪрд▓ рдФрд░ рджреВрд░реА',
        'relgadi': 'рд░реЗрд▓рдЧрд╛рдбрд╝реА',
        'nav-dhara': 'рдирд╛рд╡ рдПрдгреНрдб рдзрд╛рд░рд╛',
        'number-system': 'Number System',
        'saralikaran': 'рд╕рд░рд▓реАрдХрд░рдг',
        'trikonmiti': 'рддреНрд░рд┐рдХреЛрдгрдорд┐рддрд┐'
    },
    reasoning: {
        'coding-decoding': 'Coding Decoding',
        'analogy-test': 'Analogy Test',
        'ven-arekh': 'рд╡реЗрди рдЖрд░реЗрдЦ',
        'alphabet-test': 'Alphabet Test',
        'word-formation': 'Word Formation',
        'number-series': 'Number Series',
        'wrong-number-series': 'Worng Number Series',
        'alphabet-series': 'Alphabet series',
        'repeated-series': 'Repeated Series',
        'similar-set': 'Similar Set',
        'blood-relation': 'Blood Relation',
        'mathematical-operations': 'Mathatical Operations',
        'missing-number': 'Missing Number',
        'classification': 'Classification',
        'ranking-test': 'Ranking Test',
        'order-sequence': 'Order Sequence',
        'seating-arrangement': 'Seating arreangement',
        'pasa': 'рдкрд╛рд╕рд╛',
        'syllogism': 'Syllogism',
        'direction': 'Direction',
        'mirror-image': 'Mirror & Water Image & Paper Folding or cutting',
        'figure-completions': 'Figure Completions & Hidden Figure',
        'figure-series': 'Figure Series',
        'miscellaneous': 'Miscellaneous',
        'figure-counting': 'Figure Counting',
        'calendar': 'Calendar',
        'clock': 'clock'
    },
    gkGs: {
        'geography': 'Geography',
        'physics': 'physics',
        'polity': 'polity',
        'economics': 'economics',
        'history': 'History',
        'statik-gk': 'Statik Gk',
        'chemistry': 'Chemistry'
    }
};

/* ========== helpers ========== */
function show(screenKey, title) {
  Object.values(screens).forEach(el => el.classList.add('hidden'));
  if (screens[screenKey]) screens[screenKey].classList.remove('hidden');
  mainTitle.textContent = title || 'SSC GD QUIZ APP';
}
function setMessage(el, text, type='') {
  if (!el) return;
  el.textContent = text;
  el.className = 'message ' + (type==='success' ? 'success' : type==='error' ? 'error' : '');
  el.classList.remove('hidden');
}
function clearMessage(el) {
  if (!el) return;
  el.textContent = '';
  el.className = 'message hidden';
}
function escapeHtml(s){ if (s===undefined || s===null) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ========== render chapters ========== */
function renderChapters(subjectKey) {
  const container = screens.chapters;
  container.innerHTML = '';
  // back button
  const back = document.createElement('button');
  back.className = 'btn ghost';
  back.textContent = 'тЖР рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ';
  back.addEventListener('click', () => {
    show('subject','Subjects');
    history.pushState({screen:'subject'},'', '');
  });
  container.appendChild(back);

  // chapter list (scrollable)
  const listDiv = document.createElement('div');
  listDiv.className = 'chapter-list';
  container.appendChild(listDiv);

  const chapterObj = chaptersData[subjectKey] || {};
  for (const key in chapterObj) {
    if (chapterObj.hasOwnProperty(key)) {
      const chapterName = chapterObj[key];
      const button = document.createElement('button');
      button.className = 'btn';
      button.innerHTML = `<span>${chapterName}</span>`;
      button.addEventListener('click', () => {
        show('questions', chapterName);
        fetchQuestions(subjectKey, key);
        history.pushState({ screen: 'questions', subject: subjectKey, chapter: key }, '', '');
      });
      listDiv.appendChild(button);
    }
  }

  show('chapters', subjectsData[subjectKey] ? subjectsData[subjectKey].name : 'Chapters');
}

/* ========== fetch & show questions ========== */
let currentQuestions = [];
let currentIndex = 0;
let currentRef = null;

function fetchQuestions(subjectKey, chapterKey) {
  const qScreen = screens.questions;
  qScreen.innerHTML = '<div class="card">Loading questions...</div>';
  if (currentRef) { try { currentRef.off('value'); } catch(e){} currentRef = null; }

  const ref = db.ref(`questions/${subjectKey}/${chapterKey}`);
  currentRef = ref;
  ref.once('value')
    .then(snapshot => {
      const data = snapshot.val();
      if (!data) {
        qScreen.innerHTML = '<div class="message error">рдЗрд╕ рдЪреИрдкреНрдЯрд░ рдХреЗ рд▓рд┐рдП рдЕрднреА рдХреЛрдИ рдкреНрд░рд╢реНрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред</div>';
        return;
      }
      currentQuestions = Object.values(data);
      currentIndex = 0;
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    })
    .catch(err => {
      console.error('fetch err', err);
      qScreen.innerHTML = '<div class="message error">рдкреНрд░рд╢реНрди рд▓рд╛рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐ред</div>';
    });

  ref.on('value', snap => {
    const d = snap.val() || {};
    currentQuestions = Object.values(d);
  });
}

function showQuestion(qObj, subjectKey, chapterKey) {
  const qScreen = screens.questions;
  if (!qObj) { qScreen.innerHTML = '<div class="message">рдХреЛрдИ рдкреНрд░рд╢реНрди рдирд╣реАрдВред</div>'; return; }

  qScreen.innerHTML = `
    <div class="question-box">
      <div><strong>${currentIndex+1}.</strong> ${escapeHtml(qObj.question || '')}</div>
      <div style="margin-top:10px"><button class="btn ghost option-btn">${escapeHtml(qObj.answer || '')}</button></div>
    </div>
    <div id="desc-box" class="card hidden" style="margin-top:10px"><strong>рд╡рд┐рд╡рд░рдг:</strong><div>${escapeHtml(qObj.description || 'рдХреЛрдИ рд╡рд┐рд╡рд░рдг рдирд╣реАрдВред')}</div></div>
    <div style="margin-top:10px" class="flex">
      <button id="toggle-details-btn" class="btn">рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ</button>
      <button id="prev-q-btn" class="btn ghost">рдкрд┐рдЫрд▓рд╛ рдкреНрд░рд╢реНрди</button>
      <button id="next-q-btn" class="btn">рдЕрдЧрд▓рд╛ рдкреНрд░рд╢реНрди</button>
      <button id="back-to-chapters" class="btn ghost">тЖР рдЪреИрдкреНрдЯрд░</button>
    </div>
  `;
  
  const toggleBtn = document.getElementById('toggle-details-btn');
  const prevBtn = document.getElementById('prev-q-btn');
  const nextBtn = document.getElementById('next-q-btn');
  const backBtn = document.getElementById('back-to-chapters');
  const descBox = document.getElementById('desc-box');
  const optionBtn = qScreen.querySelector('.option-btn');

  // "рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ" button functionality (toggle)
  toggleBtn.addEventListener('click', () => {
    const isVisible = !descBox.classList.contains('hidden');
    if (isVisible) {
      descBox.classList.add('hidden');
      optionBtn.classList.remove('hidden');
      toggleBtn.textContent = 'рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ';
    } else {
      descBox.classList.remove('hidden');
      optionBtn.classList.add('hidden');
      toggleBtn.textContent = 'рд╡рд┐рд╡рд░рдг рдЫреБрдкрд╛рдПрдВ';
    }
  });

  // "Previous Question" button functionality
  prevBtn.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    }
  });
  
  // Disable "Previous" button on first question
  if (currentIndex === 0) {
      prevBtn.disabled = true;
      prevBtn.style.opacity = '0.5';
  } else {
      prevBtn.disabled = false;
      prevBtn.style.opacity = '1';
  }

  // "Next Question" button functionality
  nextBtn.addEventListener('click', () => {
    currentIndex++;
    if (currentIndex < currentQuestions.length) {
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    } else {
      qScreen.innerHTML = `
        <div class="message">рд╕рднреА рдкреНрд░рд╢реНрди рдкреВрд░реЗ рд╣реЛ рдЧрдП!</div>
        <button id="restart-btn" class="btn" style="margin-top:10px">рд╢реБрд░реВ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
      `;
      document.getElementById('restart-btn').addEventListener('click', () => { 
        currentIndex=0; 
        showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey); 
      });
    }
  });

  // "Back to Chapters" button functionality
  backBtn.addEventListener('click', () => { history.back(); });
}

/* ========== Admin Panel functionalities ========== */
function populateAdminDropdowns() {
  subjectSelect.innerHTML = '<option value="">-- рд╕рдмреНрдЬреЗрдХреНрдЯ рдЪреБрдиреЗрдВ --</option>';
  chapterSelect.innerHTML = '<option value="">-- рдЪреИрдкреНрдЯрд░ рдЪреБрдиреЗрдВ --</option>';
  questionsList.innerHTML = 'рдХреЛрдИ рдкреНрд░рд╢реНрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред';
  questionsListContainer.classList.add('hidden');

  for (const key in subjectsData) {
    const o = document.createElement('option');
    o.value = key;
    o.textContent = subjectsData[key].name;
    subjectSelect.appendChild(o);
  }
  subjectSelect.onchange = function() {
    chapterSelect.innerHTML = '<option value="">-- рдЪреИрдкреНрдЯрд░ рдЪреБрдиреЗрдВ --</option>';
    questionsList.innerHTML = 'рдХреЛрдИ рдкреНрд░рд╢реНрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред';
    questionsListContainer.classList.add('hidden');
    const sel = this.value;
    if (sel && chaptersData[sel]) {
      for (const c in chaptersData[sel]) {
        const op = document.createElement('option');
        op.value = c;
        op.textContent = chaptersData[sel][c];
        chapterSelect.appendChild(op);
      }
    }
  };
  chapterSelect.onchange = fetchQuestionsForAdmin;
}

function fetchQuestionsForAdmin() {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  questionsList.innerHTML = 'рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...';
  questionsListContainer.classList.remove('hidden');

  if (!subject || !chapter) {
    questionsList.innerHTML = 'рдХреГрдкрдпрд╛ рд╕рдмреНрдЬреЗрдХреНрдЯ рдФрд░ рдЪреИрдкреНрдЯрд░ рдЪреБрдиреЗрдВред';
    return;
  }

  const ref = db.ref(`questions/${subject}/${chapter}`);
  ref.on('value', snapshot => {
    const data = snapshot.val();
    questionsList.innerHTML = '';
    if (!data) {
      questionsList.innerHTML = 'рдХреЛрдИ рдкреНрд░рд╢реНрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред';
      return;
    }
    
    for (const key in data) {
      const q = data[key];
      const div = document.createElement('div');
      div.className = 'question-list-item';
      div.innerHTML = `
        <span>${escapeHtml(q.question)}</span>
        <div class="flex">
          <button class="btn" onclick="editQuestion('${key}', '${subject}', '${chapter}')">рдПрдбрд┐рдЯ</button>
          <button class="btn warn" onclick="deleteQuestion('${key}', '${subject}', '${chapter}')">рдбрд┐рд▓реАрдЯ</button>
        </div>
      `;
      questionsList.appendChild(div);
    }
  });
}

function resetAdminForm() {
    questionText.value = '';
    answerText.value = '';
    descriptionText.value = '';
    questionKeyInput.value = '';
    uploadQuestionBtn.classList.remove('hidden');
    updateQuestionBtn.classList.add('hidden');
    cancelEditBtn.classList.add('hidden');
    setMessage(uploadMessage, '');
}

function editQuestion(key, subject, chapter) {
    db.ref(`questions/${subject}/${chapter}/${key}`).once('value', snapshot => {
        const q = snapshot.val();
        if (q) {
            questionKeyInput.value = key;
            questionText.value = q.question;
            answerText.value = q.answer;
            descriptionText.value = q.description || '';
            uploadQuestionBtn.classList.add('hidden');
            updateQuestionBtn.classList.remove('hidden');
            cancelEditBtn.classList.remove('hidden');
        }
    });
}

function deleteQuestion(key, subject, chapter) {
    if (confirm('рдХреНрдпрд╛ рдЖрдк рд╕рдЪ рдореЗрдВ рдЗрд╕ рдкреНрд░рд╢реНрди рдХреЛ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?')) {
        db.ref(`questions/${subject}/${chapter}/${key}`).remove()
            .then(() => setMessage(uploadMessage, 'рдкреНрд░рд╢реНрди рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ред', 'success'))
            .catch(err => setMessage(uploadMessage, 'рд╣рдЯрд╛рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐: ' + err.message, 'error'));
    }
}

uploadQuestionBtn.addEventListener('click', () => {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  const question = questionText.value.trim();
  const answer = answerText.value.trim();
  const description = descriptionText.value.trim();

  if (!subject || !chapter || !question || !answer) {
    setMessage(uploadMessage, 'рдХреГрдкрдпрд╛ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдлрд╝реАрд▓реНрдб рднрд░реЗрдВред', 'error'); return;
  }

  const payload = { question, answer, description: description||null, createdAt: Date.now() };
  db.ref(`questions/${subject}/${chapter}`).push(payload)
    .then(()=>{ setMessage(uploadMessage, 'рдкреНрд░рд╢реНрди рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЕрдкрд▓реЛрдб рд╣реЛ рдЧрдпрд╛!', 'success'); resetAdminForm(); })
    .catch(err=>{ console.error('upload err', err); setMessage(uploadMessage, 'рдЕрдкрд▓реЛрдб рддреНрд░реБрдЯрд┐: '+(err.message||err),'error'); });
});

updateQuestionBtn.addEventListener('click', () => {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  const key = questionKeyInput.value;
  const question = questionText.value.trim();
  const answer = answerText.value.trim();
  const description = descriptionText.value.trim();

  if (!subject || !chapter || !key || !question || !answer) {
    setMessage(uploadMessage, 'рдХреГрдкрдпрд╛ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдлрд╝реАрд▓реНрдб рднрд░реЗрдВред', 'error'); return;
  }

  const payload = { question, answer, description: description||null };
  db.ref(`questions/${subject}/${chapter}/${key}`).update(payload)
    .then(()=>{ setMessage(uploadMessage, 'рдкреНрд░рд╢реНрди рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЕрдкрдбреЗрдЯ рд╣реЛ рдЧрдпрд╛!', 'success'); resetAdminForm(); })
    .catch(err=>{ console.error('update err', err); setMessage(uploadMessage, 'рдЕрдкрдбреЗрдЯ рддреНрд░реБрдЯрд┐: '+(err.message||err),'error'); });
});

cancelEditBtn.addEventListener('click', resetAdminForm);

/* ========== initial bindings ========== */
window.addEventListener('DOMContentLoaded', () => {
  // main nav
  sscGDBtn.addEventListener('click', ()=>{ show('subject','Subjects'); history.pushState({screen:'subject'},'', ''); });
  adminLoginBtn.addEventListener('click', ()=>{ show('adminLogin','рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди'); history.pushState({screen:'adminLogin'},'', ''); });

  // subject buttons
  if (hindiBtn) hindiBtn.addEventListener('click', ()=>{ renderChapters('hindi'); history.pushState({screen:'chapters',subject:'hindi'},'', ''); });
  if (mathBtn) mathBtn.addEventListener('click', ()=>{ renderChapters('math'); history.pushState({screen:'chapters',subject:'math'},'', ''); });
  if (reasoningBtn) reasoningBtn.addEventListener('click', ()=>{ renderChapters('reasoning'); history.pushState({screen:'chapters',subject:'reasoning'},'', ''); });
  if (gkGsBtn) gkGsBtn.addEventListener('click', ()=>{ renderChapters('gkGs'); history.pushState({screen:'chapters',subject:'gkGs'},'', ''); });

  // admin nav
  backToMainFromLogin.addEventListener('click', ()=>{ show('main'); history.pushState({screen:'main'},'', ''); });
  backToMainFromAdmin.addEventListener('click', ()=>{ show('main'); history.pushState({screen:'main'},'', ''); });

  // admin login (local)
  const ADMIN_EMAIL = "sachinkumarjii753@gmail.com";
  const ADMIN_PASS = "Sachin@802165";
  loginBtn.addEventListener('click', ()=> {
    const e = adminEmailInput.value.trim(); const p = adminPasswordInput.value;
    if (e === ADMIN_EMAIL && p === ADMIN_PASS) { populateAdminDropdowns(); show('adminPanel','рдПрдбрдорд┐рди рдкреИрдирд▓'); clearMessage(loginMessage); history.pushState({screen:'adminPanel'},'', ''); }
    else setMessage(loginMessage, 'рдЧрд▓рдд рдИрдореЗрд▓ рдпрд╛ рдкрд╛рд╕рд╡рд░реНрдбред', 'error');
  });

  // anonymous auth
  auth.signInAnonymously().then(()=>console.log('anon signed in')).catch(err=>console.warn('anon sign-in failed',err));

  // start
  show('main');
  history.replaceState({screen:'main'},'', '');
});

/* ========== popstate ========== */
window.addEventListener('popstate', (e) => {
  const s = e.state;
  if (!s) { show('main'); return; }
  if (s.screen === 'main') show('main');
  else if (s.screen === 'subject') show('subject','Subjects');
  else if (s.screen === 'chapters') renderChapters(s.subject);
  else if (s.screen === 'questions') fetchQuestions(s.subject, s.chapter);
  else if (s.screen === 'adminLogin') show('adminLogin','рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди');
  else if (s.screen === 'adminPanel') { populateAdminDropdowns(); show('adminPanel','рдПрдбрдорд┐рди рдкреИрдирд▓'); }
});
</script>
</body>
</html>
