<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSC GD QUIZ APP ‚Äî All Chapters</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    <!-- Firebase compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-database-compat.js"></script>

    <style>
        :root{
            --bg:#070d18; 
            --card:#101a2c; 
            --accent:#00bfff;
            --secondary-bg: #0b1220;
        }
        body{
            font-family:'Poppins',sans-serif;
            background:var(--bg);
            color:#fff;
            display:flex;
            align-items:center;
            justify-content:center;
            min-height:100vh;
            margin:0;
            padding:20px;
            background-image: linear-gradient(135deg, #070d18 0%, #0c1a2c 100%);
            animation: gradient-anim 15s ease infinite;
        }

        @keyframes gradient-anim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .wrap {
            width: 100%;
            max-width: 900px;
            background: rgba(15,23,36,0.5);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 191, 255, 0.1);
        }

        h1 {
            margin: 0 0 20px;
            font-size: 2.2rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 1px;
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.4);
        }
        
        /* New style for both Subjects and Chapters header */
        .glowing-header {
            font-size: 1.8rem;
            text-align: center;
            font-weight: 700;
            padding: 15px;
            border-radius: 12px;
            color: #00bfff;
            border: 2px solid #00bfff;
            box-shadow: 0 0 15px #00bfff, 0 0 25px #00bfff;
            margin-bottom: 20px;
            animation: glow-pulse 2s infinite ease-in-out;
        }
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 15px #00bfff, 0 0 25px #00bfff; }
            50% { box-shadow: 0 0 25px #00bfff, 0 0 40px #00bfff; }
        }


        .btn {
            background: var(--accent);
            color: #001;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
            transition: all 0.6s;
            z-index: -1;
        }

        .btn:hover:before {
            left: 100%;
        }
        
        /* New style for the subject buttons with red glowing outline */
        .btn.subject-glow-btn {
            background: #1f2937; /* Dark background to highlight the glow */
            color: #fff;
            border: 2px solid #ff4d4d; /* Red border */
            box-shadow: 0 0 10px #ff4d4d, 0 0 20px #ff4d4d, 0 0 30px #ff4d4d;
            padding: 15px 30px;
            font-size: 1.1rem;
            animation: pulse-glow 2s infinite ease-in-out;
            transition: transform 0.3s ease;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px #ff4d4d, 0 0 20px #ff4d4d; }
            50% { box-shadow: 0 0 20px #ff4d4d, 0 0 40px #ff4d4d; }
        }
        
        .btn.subject-glow-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 20px #ff4d4d, 0 0 40px #ff4d4d, 0 0 60px #ff4d4d;
        }

        .btn.ghost {
            background: #1f2937;
            color: #fff;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }

        .btn.ghost:hover {
            background: #2a384a;
            transform: translateY(-2px);
            box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn.warn {
            background: #ff6b6b;
            color: #fff;
            font-size: 0.9rem;
            padding: 8px 16px;
        }

        .btn.warn:hover {
            background: #e55a5a;
        }

        .flex {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .flex.centered {
            justify-content: center;
        }

        /* Adjusted flexbox for subject screen to make buttons column-like */
        .flex.col-subjects {
            flex-direction: column;
            gap: 1rem;
        }

        .hidden {
            display: none !important;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #334155;
            background: #0e1628;
            color: #fff;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.3);
        }

        label {
            font-weight: 500;
            color: #a0a8b4;
            margin-bottom: 4px;
        }

        .col {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #1f2937;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .message {
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 500;
        }

        .success {
            background: #065f46;
            color: #fff;
        }

        .error {
            background: #7f1d1d;
            color: #fff;
        }

        /* chapters list scroll */
        .chapter-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            max-height: 52vh;
            overflow: auto;
            padding-right: 8px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) #1f2937;
        }
        .chapter-list::-webkit-scrollbar { width: 8px; }
        .chapter-list::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px; }
        .chapter-list::-webkit-scrollbar-thumb { background-color: var(--accent); border-radius: 10px; border: 2px solid #1f2937; }

        .chapter-list .btn {
            width: 100%;
            text-align: center; /* Centered text */
            padding: 22px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            background: #0b1220;
            color: #fff;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }
        .chapter-list .btn:hover {
            background: #1f2937;
            border-color: var(--accent);
            transform: translateY(-2px);
        }


        .question-box {
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 16px;
            margin-top: 15px;
            border: 1px solid #1a2333;
        }
        
        .question-list-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px; 
            border-bottom: 1px solid #334155;
            transition: background-color 0.2s ease;
        }
        
        .question-list-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .question-list-item .btn {
            padding: 8px 14px;
        }

        .admin-login-link {
            font-size: 0.8rem;
            color: #9ca3af;
            text-align: center;
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        .admin-login-link:hover {
            color: var(--accent);
            text-decoration: underline;
        }
    </style>
</head>
<body>
  <div class="wrap">
    <h1 id="main-title">SSC GD QUIZ APP</h1>

    <!-- MAIN SCREEN -->
    <div id="main-screen" class="col centered">
      <div class="flex centered" style="margin-bottom:12px; flex-direction: column;">
        <button id="ssc-gd-btn" class="btn">
            <i class="fa-solid fa-graduation-cap mr-2"></i>
            üìö SSC GD
        </button>
        <!-- The requested "‡§õ‡•ã‡§ü‡•á ‡§∏‡•á ‡§¨‡§ü‡§®" below SSC GD button -->
        <button id="admin-login-btn" class="btn warn" style="margin-top: 10px; padding: 6px 12px; font-size: 0.8rem; border-radius: 8px; border: none;">
            ‚öôÔ∏è Admin Login
        </button>
      </div>
    </div>

    <!-- SUBJECT SCREEN -->
    <div id="subject-screen" class="col hidden">
      <h2 class="glowing-header">Subjects</h2>
      <!-- Subjects now in a column layout -->
      <div class="flex col-subjects centered">
        <button id="hindi-btn" class="btn subject-glow-btn">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        <button id="math-btn" class="btn subject-glow-btn">‚ûï ‡§ó‡§£‡§ø‡§§</button>
        <button id="reasoning-btn" class="btn subject-glow-btn">üß† ‡§∞‡•Ä‡§ú‡§º‡§®‡§ø‡§Ç‡§ó</button>
        <button id="gk-gs-btn" class="btn subject-glow-btn">üåç GK/GS</button>
      </div>
    </div>

    <!-- CHAPTERS SCREEN -->
    <div id="chapters-screen" class="col hidden"></div>

    <!-- QUESTIONS SCREEN -->
    <div id="questions-screen" class="col hidden"></div>

    <!-- ADMIN LOGIN SCREEN -->
    <div id="admin-login-screen" class="col hidden">
      <div class="card" style="max-width:480px">
        <label>‡§à‡§Æ‡•á‡§≤</label>
        <input id="admin-email" type="email" placeholder="‡§à‡§Æ‡•á‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" />
        <label style="margin-top:10px">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
        <input id="admin-password" type="password" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" />
        <div class="flex" style="margin-top:20px; justify-content: flex-end;">
          <button id="login-btn" class="btn">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
          <button id="back-to-main-from-login" class="btn ghost">‚Üê ‡§µ‡§æ‡§™‡§∏</button>
        </div>
        <div id="login-message" class="message hidden"></div>
      </div>
    </div>

    <!-- ADMIN PANEL SCREEN -->
    <div id="admin-panel-screen" class="col hidden">
      <div class="card" style="max-width:860px">
        <h3>‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ö‡§™‡§≤‡•ã‡§° / ‡§Æ‡•à‡§®‡•á‡§ú ‡§ï‡§∞‡•á‡§Ç</h3>
        <div class="col" style="margin-top:15px">
          <label>‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç</label>
          <select id="subject-select"></select>

          <label>‡§ö‡•à‡§™‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç</label>
          <select id="chapter-select"></select>

          <label>‡§™‡•ç‡§∞‡§∂‡•ç‡§®</label>
          <textarea id="question-text" rows="3" placeholder="‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç"></textarea>

          <label>‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞</label>
          <input id="answer-text" type="text" placeholder="‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞" />

          <label>‡§µ‡§ø‡§µ‡§∞‡§£ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</label>
          <textarea id="description-text" rows="2" placeholder="‡§µ‡§ø‡§µ‡§∞‡§£"></textarea>

          <input type="hidden" id="question-key-input" />
          
          <div class="flex" style="margin-top:10px; justify-content: flex-end;">
            <button id="upload-question-btn" class="btn">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
            <button id="update-question-btn" class="btn hidden">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
            <button id="cancel-edit-btn" class="btn ghost hidden">‡§ï‡•à‡§Ç‡§∏‡§ø‡§≤</button>
            <button id="back-to-main-from-admin" class="btn ghost">‚Üê ‡§µ‡§æ‡§™‡§∏</button>
          </div>

          <div id="upload-message" class="message hidden"></div>
        </div>

        <div id="questions-list-container" class="col" style="margin-top:30px;">
          <h4>‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</h4>
          <div id="questions-list" class="chapter-list">‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§</div>
        </div>
      </div>
    </div>

  </div>

<script>
/* ========== Firebase config ========== */
const firebaseConfig = {
  apiKey: "AIzaSyAYyEHrGV1Ev1FaMO5U3qkHUmdNEHP_IX8",
  authDomain: "sgs-study-hub.firebaseapp.com",
  databaseURL: "https://sgs-study-hub-default-rtdb.firebaseio.com",
  projectId: "sgs-study-hub",
  storageBucket: "sgs-study-hub.firebasestorage.app",
  messagingSenderId: "299932841646",
  appId: "1:299932841646:web:21120e316a9b3134a1df3f"
};
try { firebase.initializeApp(firebaseConfig); console.log('Firebase init OK'); } catch(e){ console.error(e); }
const auth = firebase.auth();
const db = firebase.database();

/* ========== UI refs ========== */
const screens = {
  main: document.getElementById('main-screen'),
  subject: document.getElementById('subject-screen'),
  chapters: document.getElementById('chapters-screen'),
  questions: document.getElementById('questions-screen'),
  adminLogin: document.getElementById('admin-login-screen'),
  adminPanel: document.getElementById('admin-panel-screen')
};
const mainTitle = document.getElementById('main-title');

const sscGDBtn = document.getElementById('ssc-gd-btn');
const adminLoginBtn = document.getElementById('admin-login-btn');

const hindiBtn = document.getElementById('hindi-btn');
const mathBtn = document.getElementById('math-btn');
const reasoningBtn = document.getElementById('reasoning-btn');
const gkGsBtn = document.getElementById('gk-gs-btn');

const subjectSelect = document.getElementById('subject-select');
const chapterSelect = document.getElementById('chapter-select');
const questionText = document.getElementById('question-text');
const answerText = document.getElementById('answer-text');
const descriptionText = document.getElementById('description-text');
const uploadQuestionBtn = document.getElementById('upload-question-btn');
const updateQuestionBtn = document.getElementById('update-question-btn');
const cancelEditBtn = document.getElementById('cancel-edit-btn');
const uploadMessage = document.getElementById('upload-message');
const questionsListContainer = document.getElementById('questions-list-container');
const questionsList = document.getElementById('questions-list');
const questionKeyInput = document.getElementById('question-key-input');

const loginBtn = document.getElementById('login-btn');
const adminEmailInput = document.getElementById('admin-email');
const adminPasswordInput = document.getElementById('admin-password');
const loginMessage = document.getElementById('login-message');
const backToMainFromLogin = document.getElementById('back-to-main-from-login');
const backToMainFromAdmin = document.getElementById('back-to-main-from-admin');

/* ========== Data ========== */
const subjectsData = {
    hindi: { name: '‡§π‡§ø‡§Ç‡§¶‡•Ä', emoji: 'üáÆüá≥' },
    math: { name: '‡§ó‡§£‡§ø‡§§', emoji: '‚ûï' },
    reasoning: { name: '‡§∞‡•Ä‡§ú‡§º‡§®‡§ø‡§Ç‡§ó', emoji: 'üß†' },
    gkGs: { name: 'GK/GS', emoji: 'üåç' }
};
const chaptersData = {
    hindi: {
        'vilom-shabd': '‡§µ‡§ø‡§≤‡•ã‡§Æ ‡§∂‡§¨‡•ç‡§¶',
        'vartaniya': '‡§µ‡§∞‡•ç‡§§‡§®‡•Ä‡§Ø',
        'vakyansh': '‡§µ‡§æ‡§ï‡•ç‡§Ø‡§æ‡§Ç‡§∂',
        'paryavachi': '‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§ö‡•Ä ‡§∂‡§¨‡•ç‡§¶',
        'tatsam-tadbhav': '‡§§‡§§‡•ç‡§∏‡§Æ ‡§§‡§¶‡•ç‡§≠‡§µ',
        'deshaj-videshaj': '‡§¶‡•á‡§∂‡§ú ‡§µ‡§ø‡§¶‡•á‡§∂‡§¶ ‡§∂‡§¨‡•ç‡§¶',
        'abhyash-prashan': '‡§Ö‡§≠‡§Ø‡§æ‡§∂ ‡§™‡•ç‡§∞‡§æ‡§∂‡§® ‡§§‡§§‡•ç‡§∏‡§Æ ‡§§‡§¶‡•ç‡§≠‡§µ',
        'shabd-yugm': '‡§∂‡§¨‡•ç‡§¶ ‡§Ø‡•Å‡§ó‡•ç‡§Æ',
        'anekarthik': '‡§Ö‡§®‡•á‡§ï‡§∞‡§•‡§ø‡§ï ‡§∂‡§¨‡•ç‡§¶',
        'sangya': '‡§∏‡§Ç‡§ú‡•ç‡§û‡§æ',
        'sarvanam': '‡§∏‡§∞‡•ç‡§µ‡§®‡§æ‡§Æ',
        'visheshad': '‡§µ‡§ø‡§∂‡•á‡§∑‡§°',
        'kriya': '‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ',
        'kaal': '‡§ï‡§æ‡§≤',
        'link': '‡§≤‡§ø‡§Ç‡§ï',
        'vachan': '‡§µ‡§ö‡§®',
        'ling-vachan-abhyas': '‡§≤‡§ø‡§Ç‡§ó ‡§µ‡§ö‡§® ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏',
        'karak': '‡§ï‡§æ‡§∞‡§ï',
        'avyay': '‡§Ö‡§µ‡•ç‡§Ø‡§Ø'
    },
    math: {
        'ratio-proporation': 'Ratio & Proporation',
        'lcm-hcf': 'LCM & HCF',
        'time-and-work': 'Time and Work',
        'pipe-tanki': 'Pipe or Tanki',
        'ausat': '‡§î‡§∏‡§§',
        'pratishat': '‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§',
        'labh-hani': '‡§≤‡§æ‡§≠ ‡§î‡§∞ ‡§π‡§æ‡§®‡•Ä',
        'batta': '‡§¨‡§ü‡•ç‡§ü‡§æ',
        'sadharan-byaj': '‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§¨‡•ç‡§Ø‡§æ‡§ú',
        'chakravridhhi-byaj': '‡§ö‡§ï‡•ç‡§∞‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§¨‡•ç‡§Ø‡§æ‡§ú',
        'samay-chal-duri': '‡§∏‡§Æ‡§Ø & ‡§ö‡§≤ ‡§î‡§∞ ‡§¶‡•Ç‡§∞‡•Ä',
        'relgadi': '‡§∞‡•á‡§≤‡§ó‡§æ‡§°‡§º‡•Ä',
        'nav-dhara': '‡§®‡§æ‡§µ ‡§è‡§£‡•ç‡§° ‡§ß‡§æ‡§∞‡§æ',
        'number-system': 'Number System',
        'saralikaran': '‡§∏‡§∞‡§≤‡•Ä‡§ï‡§∞‡§£',
        'trikonmiti': '‡§§‡•ç‡§∞‡§ø‡§ï‡•ã‡§£‡§Æ‡§ø‡§§‡§ø'
    },
    reasoning: {
        'coding-decoding': 'Coding Decoding',
        'analogy-test': 'Analogy Test',
        'ven-arekh': '‡§µ‡•á‡§® ‡§Ü‡§∞‡•á‡§ñ',
        'alphabet-test': 'Alphabet Test',
        'word-formation': 'Word Formation',
        'number-series': 'Number Series',
        'wrong-number-series': 'Worng Number Series',
        'alphabet-series': 'Alphabet series',
        'repeated-series': 'Repeated Series',
        'similar-set': 'Similar Set',
        'blood-relation': 'Blood Relation',
        'mathematical-operations': 'Mathatical Operations',
        'missing-number': 'Missing Number',
        'classification': 'Classification',
        'ranking-test': 'Ranking Test',
        'order-sequence': 'Order Sequence',
        'seating-arrangement': 'Seating arreangement',
        'pasa': '‡§™‡§æ‡§∏‡§æ',
        'syllogism': 'Syllogism',
        'direction': 'Direction',
        'mirror-image': 'Mirror & Water Image & Paper Folding or cutting',
        'figure-completions': 'Figure Completions & Hidden Figure',
        'figure-series': 'Figure Series',
        'miscellaneous': 'Miscellaneous',
        'figure-counting': 'Figure Counting',
        'calendar': 'Calendar',
        'clock': 'clock'
    },
    gkGs: {
        'geography': 'Geography',
        'physics': 'physics',
        'polity': 'polity',
        'economics': 'economics',
        'history': 'History',
        'statik-gk': 'Statik Gk',
        'chemistry': 'Chemistry'
    }
};

/* ========== helpers ========== */
function show(screenKey, title) {
  Object.values(screens).forEach(el => el.classList.add('hidden'));
  if (screens[screenKey]) screens[screenKey].classList.remove('hidden');
  mainTitle.textContent = title || 'SSC GD QUIZ APP';
}
function setMessage(el, text, type='') {
  if (!el) return;
  el.textContent = text;
  el.className = 'message ' + (type==='success' ? 'success' : type==='error' ? 'error' : '');
  el.classList.remove('hidden');
}
function clearMessage(el) {
  if (!el) return;
  el.textContent = '';
  el.className = 'message hidden';
}
function escapeHtml(s){ if (s===undefined || s===null) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ========== render chapters ========== */
function renderChapters(subjectKey) {
  const container = screens.chapters;
  container.innerHTML = '';
  
  // New: Chapters header
  const header = document.createElement('h2');
  header.className = 'glowing-header';
  header.textContent = 'Chapters';
  container.appendChild(header);

  // back button
  const back = document.createElement('button');
  back.className = 'btn ghost';
  back.textContent = '‚Üê ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç';
  back.addEventListener('click', () => {
    show('subject','Subjects');
    history.pushState({screen:'subject'},'', '');
  });
  container.appendChild(back);

  // chapter list (scrollable)
  const listDiv = document.createElement('div');
  listDiv.className = 'chapter-list';
  container.appendChild(listDiv);

  const chapterObj = chaptersData[subjectKey] || {};
  for (const key in chapterObj) {
    if (chapterObj.hasOwnProperty(key)) {
      const chapterName = chapterObj[key];
      const button = document.createElement('button');
      button.className = 'btn';
      button.innerHTML = `<span>${chapterName}</span>`;
      button.addEventListener('click', () => {
        show('questions', chapterName);
        fetchQuestions(subjectKey, key);
        history.pushState({ screen: 'questions', subject: subjectKey, chapter: key }, '', '');
      });
      listDiv.appendChild(button);
    }
  }

  show('chapters', subjectsData[subjectKey] ? subjectsData[subjectKey].name : 'Chapters');
}

/* ========== fetch & show questions ========== */
let currentQuestions = [];
let currentIndex = 0;
let currentRef = null;

function fetchQuestions(subjectKey, chapterKey) {
  const qScreen = screens.questions;
  qScreen.innerHTML = '<div class="card">Loading questions...</div>';
  if (currentRef) { try { currentRef.off('value'); } catch(e){} currentRef = null; }

  const ref = db.ref(`questions/${subjectKey}/${chapterKey}`);
  currentRef = ref;
  ref.once('value')
    .then(snapshot => {
      const data = snapshot.val();
      if (!data) {
        qScreen.innerHTML = '<div class="message error">‡§á‡§∏ ‡§ö‡•à‡§™‡•ç‡§ü‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§</div>';
        return;
      }
      currentQuestions = Object.values(data);
      currentIndex = 0;
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    })
    .catch(err => {
      console.error('fetch err', err);
      qScreen.innerHTML = '<div class="message error">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≤‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§</div>';
    });

  ref.on('value', snap => {
    const d = snap.val() || {};
    currentQuestions = Object.values(d);
  });
}

function showQuestion(qObj, subjectKey, chapterKey) {
  const qScreen = screens.questions;
  if (!qObj) { qScreen.innerHTML = '<div class="message">‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç‡•§</div>'; return; }

  qScreen.innerHTML = `
    <div class="question-box">
      <div><strong>${currentIndex+1}.</strong> ${escapeHtml(qObj.question || '')}</div>
      <div style="margin-top:10px"><button class="btn ghost option-btn">${escapeHtml(qObj.answer || '')}</button></div>
    </div>
    <div id="desc-box" class="card hidden" style="margin-top:10px"><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong><div>${escapeHtml(qObj.description || '‡§ï‡•ã‡§à ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç‡•§')}</div></div>
    <div style="margin-top:10px" class="flex">
      <button id="toggle-details-btn" class="btn">‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
      <button id="prev-q-btn" class="btn ghost">‡§™‡§ø‡§õ‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</button>
      <button id="next-q-btn" class="btn">‡§Ö‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</button>
      <button id="back-to-chapters" class="btn ghost">‚Üê ‡§ö‡•à‡§™‡•ç‡§ü‡§∞</button>
    </div>
  `;
  
  const toggleBtn = document.getElementById('toggle-details-btn');
  const prevBtn = document.getElementById('prev-q-btn');
  const nextBtn = document.getElementById('next-q-btn');
  const backBtn = document.getElementById('back-to-chapters');
  const descBox = document.getElementById('desc-box');
  const optionBtn = qScreen.querySelector('.option-btn');

  // "‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç" button functionality (toggle)
  toggleBtn.addEventListener('click', () => {
    const isVisible = !descBox.classList.contains('hidden');
    if (isVisible) {
      descBox.classList.add('hidden');
      optionBtn.classList.remove('hidden');
      toggleBtn.textContent = '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç';
    } else {
      descBox.classList.remove('hidden');
      optionBtn.classList.add('hidden');
      toggleBtn.textContent = '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§õ‡•Å‡§™‡§æ‡§è‡§Ç';
    }
  });

  // "Previous Question" button functionality
  prevBtn.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    }
  });
  
  // Disable "Previous" button on first question
  if (currentIndex === 0) {
      prevBtn.disabled = true;
      prevBtn.style.opacity = '0.5';
  } else {
      prevBtn.disabled = false;
      prevBtn.style.opacity = '1';
  }

  // "Next Question" button functionality
  nextBtn.addEventListener('click', () => {
    currentIndex++;
    if (currentIndex < currentQuestions.length) {
      showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey);
    } else {
      qScreen.innerHTML = `
        <div class="message">‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§∞‡•á ‡§π‡•ã ‡§ó‡§è!</div>
        <button id="restart-btn" class="btn" style="margin-top:10px">‡§∂‡•Å‡§∞‡•Ç ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
      `;
      document.getElementById('restart-btn').addEventListener('click', () => { 
        currentIndex=0; 
        showQuestion(currentQuestions[currentIndex], subjectKey, chapterKey); 
      });
    }
  });

  // "Back to Chapters" button functionality
  backBtn.addEventListener('click', () => { history.back(); });
}

/* ========== Admin Panel functionalities ========== */
function populateAdminDropdowns() {
  subjectSelect.innerHTML = '<option value="">-- ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
  chapterSelect.innerHTML = '<option value="">-- ‡§ö‡•à‡§™‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
  questionsList.innerHTML = '‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§';
  questionsListContainer.classList.add('hidden');

  for (const key in subjectsData) {
    const o = document.createElement('option');
    o.value = key;
    o.textContent = subjectsData[key].name;
    subjectSelect.appendChild(o);
  }
  subjectSelect.onchange = function() {
    chapterSelect.innerHTML = '<option value="">-- ‡§ö‡•à‡§™‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
    questionsList.innerHTML = '‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§';
    questionsListContainer.classList.add('hidden');
    const sel = this.value;
    if (sel && chaptersData[sel]) {
      for (const c in chaptersData[sel]) {
        const op = document.createElement('option');
        op.value = c;
        op.textContent = chaptersData[sel][c];
        chapterSelect.appendChild(op);
      }
    }
  };
  chapterSelect.onchange = fetchQuestionsForAdmin;
}

function fetchQuestionsForAdmin() {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  questionsList.innerHTML = '‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
  questionsListContainer.classList.remove('hidden');

  if (!subject || !chapter) {
    questionsList.innerHTML = '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§î‡§∞ ‡§ö‡•à‡§™‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§';
    return;
  }

  const ref = db.ref(`questions/${subject}/${chapter}`);
  ref.on('value', snapshot => {
    const data = snapshot.val();
    questionsList.innerHTML = '';
    if (!data) {
      questionsList.innerHTML = '‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§';
      return;
    }
    
    for (const key in data) {
      const q = data[key];
      const div = document.createElement('div');
      div.className = 'question-list-item';
      div.innerHTML = `
        <span>${escapeHtml(q.question)}</span>
        <div class="flex">
          <button class="btn" onclick="editQuestion('${key}', '${subject}', '${chapter}')">‡§è‡§°‡§ø‡§ü</button>
          <button class="btn warn" onclick="deleteQuestion('${key}', '${subject}', '${chapter}')">‡§°‡§ø‡§≤‡•Ä‡§ü</button>
        </div>
      `;
      questionsList.appendChild(div);
    }
  });
}

function resetAdminForm() {
    questionText.value = '';
    answerText.value = '';
    descriptionText.value = '';
    questionKeyInput.value = '';
    uploadQuestionBtn.classList.remove('hidden');
    updateQuestionBtn.classList.add('hidden');
    cancelEditBtn.classList.add('hidden');
    setMessage(uploadMessage, '');
}

function deleteQuestion(key, subject, chapter) {
    const modal = document.createElement('div');
    modal.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000;";
    modal.innerHTML = `
        <div class="card" style="padding: 2rem; max-width: 400px; text-align: center; border: 1px solid #ff6b6b;">
            <p>‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§ö ‡§Æ‡•á‡§Ç ‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?</p>
            <div class="flex" style="justify-content: center; margin-top: 1.5rem;">
                <button id="confirm-delete" class="btn warn">‡§π‡§æ‡§Å, ‡§π‡§ü‡§æ‡§è‡§Å</button>
                <button id="cancel-delete" class="btn ghost">‡§®‡§π‡•Ä‡§Ç, ‡§ï‡•à‡§Ç‡§∏‡§ø‡§≤</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    document.getElementById('confirm-delete').addEventListener('click', () => {
        db.ref(`questions/${subject}/${chapter}/${key}`).remove()
            .then(() => setMessage(uploadMessage, '‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§', 'success'))
            .catch(err => setMessage(uploadMessage, '‡§π‡§ü‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + err.message, 'error'));
        document.body.removeChild(modal);
    });
    document.getElementById('cancel-delete').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
}

function editQuestion(key, subject, chapter) {
    db.ref(`questions/${subject}/${chapter}/${key}`).once('value', snapshot => {
        const q = snapshot.val();
        if (q) {
            questionKeyInput.value = key;
            questionText.value = q.question;
            answerText.value = q.answer;
            descriptionText.value = q.description || '';
            uploadQuestionBtn.classList.add('hidden');
            updateQuestionBtn.classList.remove('hidden');
            cancelEditBtn.classList.remove('hidden');
        }
    });
}


uploadQuestionBtn.addEventListener('click', () => {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  const question = questionText.value.trim();
  const answer = answerText.value.trim();
  const description = descriptionText.value.trim();

  if (!subject || !chapter || !question || !answer) {
    setMessage(uploadMessage, '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§', 'error'); return;
  }

  const payload = { question, answer, description: description||null, createdAt: Date.now() };
  db.ref(`questions/${subject}/${chapter}`).push(payload)
    .then(()=>{ setMessage(uploadMessage, '‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success'); resetAdminForm(); })
    .catch(err=>{ console.error('upload err', err); setMessage(uploadMessage, '‡§Ö‡§™‡§≤‡•ã‡§° ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: '+(err.message||err),'error'); });
});

updateQuestionBtn.addEventListener('click', () => {
  const subject = subjectSelect.value;
  const chapter = chapterSelect.value;
  const key = questionKeyInput.value;
  const question = questionText.value.trim();
  const answer = answerText.value.trim();
  const description = descriptionText.value.trim();

  if (!subject || !chapter || !key || !question || !answer) {
    setMessage(uploadMessage, '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§', 'error'); return;
  }

  const payload = { question, answer, description: description||null };
  db.ref(`questions/${subject}/${chapter}/${key}`).update(payload)
    .then(()=>{ setMessage(uploadMessage, '‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success'); resetAdminForm(); })
    .catch(err=>{ console.error('update err', err); setMessage(uploadMessage, '‡§Ö‡§™‡§°‡•á‡§ü ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: '+(err.message||err),'error'); });
});

cancelEditBtn.addEventListener('click', resetAdminForm);

/* ========== initial bindings ========== */
window.addEventListener('DOMContentLoaded', () => {
  // main nav
  sscGDBtn.addEventListener('click', ()=>{ show('subject','Subjects'); history.pushState({screen:'subject'},'', ''); });
  adminLoginBtn.addEventListener('click', ()=>{ show('adminLogin','‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®'); history.pushState({screen:'adminLogin'},'', ''); });

  // subject buttons
  if (hindiBtn) hindiBtn.addEventListener('click', ()=>{ renderChapters('hindi'); history.pushState({screen:'chapters',subject:'hindi'},'', ''); });
  if (mathBtn) mathBtn.addEventListener('click', ()=>{ renderChapters('math'); history.pushState({screen:'chapters',subject:'math'},'', ''); });
  if (reasoningBtn) reasoningBtn.addEventListener('click', ()=>{ renderChapters('reasoning'); history.pushState({screen:'chapters',subject:'reasoning'},'', ''); });
  if (gkGsBtn) gkGsBtn.addEventListener('click', ()=>{ renderChapters('gkGs'); history.pushState({screen:'chapters',subject:'gkGs'},'', ''); });

  // admin nav
  backToMainFromLogin.addEventListener('click', ()=>{ show('main'); history.pushState({screen:'main'},'', ''); });
  backToMainFromAdmin.addEventListener('click', ()=>{ show('main'); history.pushState({screen:'main'},'', ''); });

  // admin login (local)
  const ADMIN_EMAIL = "sachinkumarjii753@gmail.com";
  const ADMIN_PASS = "Sachin@802165";
  loginBtn.addEventListener('click', ()=> {
    const e = adminEmailInput.value.trim(); const p = adminPasswordInput.value;
    if (e === ADMIN_EMAIL && p === ADMIN_PASS) { populateAdminDropdowns(); show('adminPanel','‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤'); clearMessage(loginMessage); history.pushState({screen:'adminPanel'},'', ''); }
    else setMessage(loginMessage, '‡§ó‡§≤‡§§ ‡§à‡§Æ‡•á‡§≤ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°‡•§', 'error');
  });

  // anonymous auth
  auth.signInAnonymously().then(()=>console.log('anon signed in')).catch(err=>console.warn('anon sign-in failed',err));

  // start
  show('main');
  history.replaceState({screen:'main'},'', '');
});

/* ========== popstate ========== */
window.addEventListener('popstate', (e) => {
  const s = e.state;
  if (!s) { show('main'); return; }
  if (s.screen === 'main') show('main');
  else if (s.screen === 'subject') show('subject','Subjects');
  else if (s.screen === 'chapters') renderChapters(s.subject);
  else if (s.screen === 'questions') fetchQuestions(s.subject, s.chapter);
  else if (s.screen === 'adminLogin') show('adminLogin','‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®');
  else if (s.screen === 'adminPanel') { populateAdminDropdowns(); show('adminPanel','‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤'); }
});
</script>
</body>
</html>
